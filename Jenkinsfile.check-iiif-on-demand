elifePipeline {
    stage 'Checkout formula', {
        checkout scm
    }

    lock('iiif--ci') {
        stage 'Deploy to IIIF server', {
            builderDeployRevision 'iiif--ci', params.revision
        }

        stage 'Load all articles .tif files', {
            sh './list-all-figures.sh | ./load-figures.sh'
        }
    }

    stage 'Check log .tif files', {
        sh './check-log-figure.sh load-figures.log'
    }
}
